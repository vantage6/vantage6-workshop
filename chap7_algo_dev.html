<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to vantage6: Algorithm development</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/chap7_algo_dev.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to vantage6
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to vantage6
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to vantage6
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 63%" class="percentage">
    63%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 63%" aria-valuenow="63" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/chap7_algo_dev.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="chap1_introduction_FL.html">1. Introduction to privacy enhancing technologies (PET)</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="chap2_introduction_v6.html">2. vantage6 basics</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="chap3_run_analysis_ui.html">3. Running a PET analysis without programming on vantage6</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="chap4_manage_via_ui.html">4. Managing vantage6 server via the user interface</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="chap5_python_client.html">5. Running a PET analysis using the Python client</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="chap6_setup_node.html">6. Setting up a vantage6 node</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Algorithm development
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#algorithm-tools">Algorithm tools</a></li>
<li><a href="#create-a-simple-algorithm">Create a simple algorithm</a></li>
<li><a href="#build-your-algorithm-into-a-docker-image">Build your algorithm into a docker image</a></li>
<li><a href="#set-up-a-local-test-environment">Set up a local test environment</a></li>
<li><a href="#publish-your-algorithm-in-the-algorithm-store">Publish your algorithm in the algorithm store</a></li>
<li><a href="#next-steps">Next steps</a></li>
<li><a href="#future-changes">Future changes</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="chap8_own_project.html">8. Work on your own project</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="chap6_setup_node.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="chap8_own_project.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="chap6_setup_node.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Setting up a
        </a>
        <a class="chapter-link float-end" href="chap8_own_project.html" rel="next">
          Next: Work on your own...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Algorithm development</h1>
        <p>Last updated on 2024-10-02 |

        <a href="https://github.com/vantage6/vantage6-workshop/edit/main/episodes/chap7_algo_dev.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What do the algorithm tools in vantage6 provide?</li>
<li>How do you create a personalized boilerplate using the v6 cli?</li>
<li>What is the process for adapting the boilerplate into a simple
algorithm?</li>
<li>How can you test your algorithm using the mock client?</li>
<li>How do you build your algorithm into a docker image?</li>
<li>How do you set up a local test environment using the v6 cli
(<code>v6 dev</code>)?</li>
<li>How can you publish your algorithm in the algorithm store?</li>
<li>How can you run your algorithm?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the available algorithm tools</li>
<li>Create a personalized boilerplate using the v6 cli</li>
<li>Adapt the boilerplate into a simple algorithm</li>
<li>Test your algorithm using the mock client</li>
<li>Build your algorithm into a docker image</li>
<li>Set up a local test environment using the v6 cli
(<code>v6 dev</code>)</li>
<li>Publish your algorithm in the algorithm store</li>
<li>Run your algorithm in the UI</li>
<li>Run your algorithm with the Python client</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<hr class="half-width"><p>The goal of this lesson is to develop a simple average algorithm, and
walk through all the steps from creating the proper code up until
running it in the User Interface and via the Python client. We will
start by explaining how the algorithm interacts with the vantage6
infrastructure. Then, you will start to build, test and run your own
algorithm.</p>
</section><section><h2 class="section-heading" id="algorithm-tools">Algorithm tools<a class="anchor" aria-label="anchor" href="#algorithm-tools"></a></h2>
<hr class="half-width"><p>The vantage6 infrastructure provides a set of tools to help you
develop your algorithm. You have probably already done this in the <a href="index.html#setup">setup</a> of the workshop, but you can install the
algorithm tools with:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">pip</span> install vantage6-algorithm-tools</span></code></pre>
</div>
<p>The following sections handle the most important parts of the
algorithm tools.</p>
<div class="section level3">
<h3 id="algorithm-client">Algorithm client<a class="anchor" aria-label="anchor" href="#algorithm-client"></a></h3>
<p>The algorithm client provides functionality that is similar to the
Python client, but can only do a subset of the operations, because the
algorithm is not allowed to execute operations like creating a
collaboration or deleting a user. This client can be used to interact
with the server, e.g.Â to create a subtask, retrieve results, or get the
organizations participating in the collaboration.</p>
<p>A typical example of how to use the algorithm client is as
follows:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> vantage6.algorithm.client <span class="im">import</span> AlgorithmClient</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="im">from</span> vantage6.algorithm.tools.decorators <span class="im">import</span> algorithm_client</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Load the algorithm client to interact with the server</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">@algorithm_client</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="kw">def</span> central_function(client: AlgorithmClient):</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    organizations_in_collaboration <span class="op">=</span> client.organization.<span class="bu">list</span>()</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    task <span class="op">=</span> client.task.create(</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>        input_<span class="op">=**</span>my_input,</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>        organizations<span class="op">=</span>organizations_in_collaboration,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Subtask name"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    )</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    results <span class="op">=</span> client.wait_for_results(task.get(<span class="st">'id'</span>))</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="cf">return</span> aggregate_results(results)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="data-loading">Data loading<a class="anchor" aria-label="anchor" href="#data-loading"></a></h3>
<p>The algorithm tools provide a way to load the data from the node and
provide it to the algorithm as a Pandas dataframe.</p>
<p>Example:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">from</span> vantage6.algorithm.tools.decorators <span class="im">import</span> data</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Load two data sources from the node</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="at">@data</span>(<span class="dv">2</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="kw">def</span> partial_function(df1: pd.DataFrame, df2: pd.DataFrame, column: <span class="bu">str</span>):</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        <span class="st">"sum1"</span>: df1[column].<span class="bu">sum</span>(),</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>        <span class="st">"sum2"</span>: df2[column].<span class="bu">sum</span>()</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    }</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="wrapping-the-algorithm-functions">Wrapping the algorithm functions<a class="anchor" aria-label="anchor" href="#wrapping-the-algorithm-functions"></a></h3>
<p>The algorithm client and data loading tools provide you with the
vantage6 tools in the algorithm code itself. However, the algorithm
tools also provide an interface between the algorithm and the node,
which we call the algorithm wrapper. The wrapper ensures that all the
necessary information is passed to the algorithm, and that the output is
returned to the server. Mostly this is â€˜magicâ€™ that happens in the
background. It is important to know about it though, as it can help you
understand how the algorithm interacts with the vantage6 infrastructure,
and you can use the wrapper to e.g.Â pass environment variables to the
algorithm.</p>
<figure><img src="fig/chapter7/algorithm_wrapper.png" alt="Algorithm wrapper" class="figure mx-auto d-block"><div class="figcaption">Algorithm wrapper</div>
</figure><p>The following items are handled by the wrapper:</p>
<ul><li>
<strong>Input handling</strong>: the algorithm tools read the input
from the node and provide it to the arguments of the algorithm function.
In the example above, the <code>column</code> argument is provided by
the node to the function via the algorithm tools.</li>
<li>
<strong>Environment variables</strong>: the algorithm tools get the
environment variables from the node and pass them on to the algorithm.
You can also define environment variables in the node configuration file
that are passed to the algorithm. This can e.g.Â be useful if you want to
pass the database connection string to the algorithm.</li>
<li>
<strong>Token</strong>: the algorithm tools ensure that the
algorithm uses the security token to be able to get the allowed
resources from the server.</li>
<li>
<strong>Data</strong>: while the actual data is handled by the
<code>@data</code> decorator, the algorithm tools provide the decorator
with environment variables so that it knows where to find the data.</li>
<li>
<strong>Output handling</strong>: the output from the algorithm
functions is written to a file that the node will send back to the
server.</li>
</ul><p>It is possible to write your algorithm without the algorithm tools.
If you want to write your algorithm in a different language than Python,
you cannot use the algorithm tools.</p>
<p>For more information about the algorithm tools, please check out the
relevant <a href="https://docs.vantage6.ai/en/main/algorithms/concepts.html" class="external-link">documentation</a>.</p>
<div id="challenge-1-creating-non-python-algorithms" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-creating-non-python-algorithms" class="callout-inner">
<h3 class="callout-title">Challenge 1: Creating non-Python algorithms</h3>
<div class="callout-content">
<p>You want to create a vantage6 algorithm, but Python is not your
favorite programming language. What extra work do you need to do to
create a vantage6 algorithm in a different language?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>You would need to implement parts of the wrapper and algorithm client
yourself:</p>
<ul><li>You should use the environment variables to load the token, input
and data</li>
<li>You should create your own HTTP requests to replace the algorithm
client</li>
<li>You should make sure the output is written to the correct place</li>
</ul></div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="create-a-simple-algorithm">Create a simple algorithm<a class="anchor" aria-label="anchor" href="#create-a-simple-algorithm"></a></h2>
<hr class="half-width"><p>As discussed above, vantage6 algorithms require a certain structure
to interact properly with the vantage6 infrastructure. For example,
vantage6 requires the functions in the algorithm to be at the base level
of a Python package that is defined within the Docker image. Such
requirements can be cumbersome to get right if you have to write all the
code yourself. Fortunately, vantage6 provides tools to create a
boilerplate for you, so that you can focus on the development of your
algorithm functions rather than worry about the infrastructure.</p>
<p>To create a personalized boilerplate, use the vantage6 CLI. You
should have installed the CLI in the <a href="index.html#setup">workshop
setup</a>. Be sure to activate the <a href="index.html#python-environment-and-python-packages">conda
environment</a> you created for the workshop.</p>
<p>You can create a new algorithm boilerplate repository with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">v6</span> algorithm create</span></code></pre>
</div>
<p>The first step in creating your own algorithm is to enter the command
<code>v6 algorithm create</code> and type along to create your own
personalized boilerplate:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;</span> v6 <span class="ex">algorithm</span> create</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">?</span> Name of your new algorithm: my-vantage6-average</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">?</span> Directory to put the algorithm in: <span class="dt">\s</span>ome<span class="dt">\l</span>ocal<span class="dt">\d</span>irectory<span class="dt">\f</span>or<span class="dt">\a</span>lgorithms<span class="dt">\m</span>y-vantage6-average</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="ex">Welcome</span> to the vantage6 algorithm template creator!</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="ex">You</span> will be asked a series of questions to generate the basis of your new</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="ex">vantage6</span> algorithm in Python.</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Please enter a short description <span class="er">(</span><span class="ex">one</span> sentence<span class="kw">)</span> <span class="ex">of</span> your algorithm.</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>   <span class="ex">My</span> very first vantage6 algorithm, computing the average of a single data column</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> The open source license to use</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>   <span class="ex">MIT</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use a central function in your algorithm<span class="pp">?</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>   <span class="ex">Yes</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> What is the name of your central function<span class="pp">?</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>   <span class="ex">central</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use a client in your central function<span class="pp">?</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>   <span class="ex">Yes</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use data in your central function<span class="pp">?</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>   <span class="ex">No</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Add a list of arguments to the central function <span class="st">'central'</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    <span class="kw">(</span><span class="ex">Finish</span> with <span class="st">'Alt+Enter'</span> or <span class="st">'Esc then Enter'</span><span class="kw">)</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="op">&gt;</span> <span class="bu">[</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    <span class="st">"column"</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>  <span class="bu">]</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use a partial function in your algorithm<span class="pp">?</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>   <span class="ex">Yes</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> What is the name of your partial function<span class="pp">?</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>   <span class="ex">partial</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use a client in your partial function<span class="pp">?</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>   <span class="ex">No</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to use data in your partial function<span class="pp">?</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>   <span class="ex">Yes</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> How many databases do you want to use in your partial function<span class="pp">?</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>   <span class="ex">1</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Add a list of arguments to the partial function <span class="st">'partial'</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>    <span class="kw">(</span><span class="ex">Finish</span> with <span class="st">'Alt+Enter'</span> or <span class="st">'Esc then Enter'</span><span class="kw">)</span></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a><span class="op">&gt;</span> <span class="bu">[</span></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>    <span class="st">"column"</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>  <span class="bu">]</span></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to add documentation to your algorithm<span class="pp">?</span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>   <span class="ex">No</span></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a><span class="ex">ðŸŽ¤</span> Do you want to see the advanced options<span class="pp">?</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>   <span class="ex">No</span></span></code></pre>
</div>
<p>That should give you a nice head-start to develop your own
algorithm!</p>
<div id="challenge-2-learn-about-your-personalized-boilerplate" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-learn-about-your-personalized-boilerplate" class="callout-inner">
<h3 class="callout-title">Challenge 2: Learn about your personalized boilerplate</h3>
<div class="callout-content">
<p>Inspect your personalized boilerplate code. What does it contain?
Multiple answers are possible.</p>
<p>A. Templates of your algorithm functions B. Arguments of your
algorithm functions C. Scripts to test your algorithm functions D.
Checklist of what to do to complete your algorithm E. A JSON file that
helps to include the algorithm in an algorithm store</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>The answers is that it contains <em>all</em> those things. The
boilerplate was designed to be as complete as possible!</p>
<p>A. Templates of your algorithm functions: the boilerplate contains
the central and partial functions that you specified in the creation
process, in the files <code>central.py</code> and
<code>partial.py</code>, in the folder with the algorithm name you
specified in the first question. B. Arguments of your algorithm
functions: within the files specified in the previous point, you can see
that the parameters are already defined in the function signature. C.
Scripts to test your algorithm functions: the boilerplate contains a
<code>test.py</code> file in the <code>test/</code> directory. Some
details still need to be adjusted to test your algorithm - weâ€™ll come to
that later in this lesson. D. Checklist of what to do to complete your
algorithm: the <code>README.md</code> file in the root directory of your
algorithm contains a checklist of what you need to do to complete your
algorithm. E. A JSON file that helps to include the algorithm in an
algorithm store: the boilerplate contains an
<code>algorithm_store.json</code> file that contains a JSON description
of your algorithm. This file is used to upload your algorithm to the
algorithm store.</p>
<p>Missing anything? Let us know!</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="modifying-the-boilerplate">Modifying the boilerplate<a class="anchor" aria-label="anchor" href="#modifying-the-boilerplate"></a></h3>
<p>If you want to modify the answers you gave in
<code>v6 algorithm create</code>, you can do so by running:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">v6</span> algorithm update <span class="at">--change-answers</span></span></code></pre>
</div>
<p>This is recommended to do whenever you want to change something like
the name of the function, as it will ensure that it will be updated in
all places it was mentioned.</p>
<p>The update command can also be used without
<code>--change-answers</code> to update your algorithm to a new version,
even after you have implemented your functions. This is helpful when
there is new functionality or changes in vantage6 that require
algorithms to update.</p>
</div>
<div class="section level3">
<h3 id="implement-the-algorithm-functions">Implement the algorithm functions<a class="anchor" aria-label="anchor" href="#implement-the-algorithm-functions"></a></h3>
<p>Your personalized boilerplate is now ready to be adapted into a
simple algorithm. We are now going to implement the average algorithm in
several steps. First, we will explain how this can be done, and then you
can try it yourself in a challenge.</p>
<p>First step is to implement the central and partial functions. The
easiest is to start with the partial function. Using the Pandas
dataframe that is provided by the algorithm tools, the following should
be extracted for the requested column:</p>
<ul><li>The number of rows that contains a number</li>
<li>The sum of all these numbers</li>
</ul><p>The boilerplate code for the central function already a large part of
the code that will be required to gather the results from the partial
functions. To compute the final average, we will need to:</p>
<ul><li>Modify how the subtasks are created - we need to provide the column
to the partial functions</li>
<li>Combine the results from the partial functions to compute the
average</li>
</ul><p>Remember that both functions should return the results as valid JSON
serializable objects - we recommend returning a Python dictionary.</p>
</div>
<div class="section level3">
<h3 id="test-your-algorithm-using-the-mock-client">Test your algorithm using the mock client<a class="anchor" aria-label="anchor" href="#test-your-algorithm-using-the-mock-client"></a></h3>
<p>As discussed before, the algorithm tools contain an algorithm client
that helps the algorithm container to communicate with the server. When
testing your algorithm, it would be cumbersome to test your algorithm in
the real infrastructure on every code change, as this requires you to
build your algorithm Docker image, ensure all nodes in your
collaboration are online, etc.</p>
<p>To facilitate the testing phase, the algorithm tools also provide an
algorithm mock client. This client can be used to test your algorithm
locally without having to start up the server and nodes. The mock client
provides the same functions as the algorithm client, but instead of
communicating with the server, it simply returns a smart mock response.
The mock client does <em>not</em> mock the output of the algorithm
functions, but actually calls them with locally defined test data. This
way, you can easily test locally if your algorithm functions give the
answer you expect without worrying about the infrastructure.</p>
<p>Your personalized template already contains a
<code>test/test.py</code> file that contains boilerplate code to test
your algorithm. You just need to make small adjustments to test your
average algorithm.</p>
<div id="challenge-3-implement-the-functions-and-test-them" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3-implement-the-functions-and-test-them" class="callout-inner">
<h3 class="callout-title">Challenge 3: Implement the functions and test them</h3>
<div class="callout-content">
<p>Implement your partial and central functions as described above.</p>
<p>Adapt and run <code>test.py</code> to test your function
implementation:</p>
<ul><li>In your Python environment, run <code>pip install -e .</code>. This
installs the local Python package and also the algorithm tools (which
contain the mock client).</li>
<li>Adjust <code>test.py</code> to compute the average over the
<strong>Age</strong> column. Do this both for the test of the central
and of the partial function</li>
<li>Run <code>test.py</code> to test your functions.</li>
</ul></div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>We provide a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" class="external-link">pandas
dataframe</a>. Pandas is a well-known Python library for data
manipulation and analysis. It also provides a <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sum.html#pandas.DataFrame.sum" class="external-link">sum</a>
method that can be used to calculate the sum of a column.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>You can find the solution in the <a href="https://github.com/vantage6/workshop-average-boilerplate/tree/implemented-functions" class="external-link">workshop-average-boilerplate
repository</a>. This branch contains the implementation of the average
algorithm. Below is a description of what you need to change compared to
the boilerplate you generated in Challenge 1.</p>
<p>In your central function:</p>
<ul><li>When creating the subtask, fill in the <code>column</code> argument
from the input parameters.</li>
<li>Aggregate the results from the partial functions to compute the
average, which may look something like this:</li>
</ul><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">def</span> central_function(client: AlgorithmClient, column: <span class="bu">str</span>):</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    ...</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    results <span class="op">=</span> client.wait_for_results(task_id<span class="op">=</span>task.get(<span class="st">"id"</span>))</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    info(<span class="st">"Computing global average"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    global_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    global_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="cf">for</span> output <span class="kw">in</span> results:</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        global_sum <span class="op">+=</span> output[<span class="st">"sum"</span>]</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>        global_count <span class="op">+=</span> output[<span class="st">"count"</span>]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    <span class="co"># return the final results of the algorithm</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"average"</span>: global_sum <span class="op">/</span> global_count}</span></code></pre>
</div>
<p>In your partial function:</p>
<ul><li>Extract the column from the dataframe and calculate the sum and
count of the column values. The output should be a dictionary with the
keys <code>sum</code> and <code>count</code>:</li>
</ul><div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">@data</span>(<span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">def</span> partial_function(df: pd.DataFrame, column: <span class="bu">str</span>) <span class="op">-&gt;</span> Any:</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    col_data <span class="op">=</span> df[column]</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    local_sum <span class="op">=</span> <span class="bu">float</span>(col_data.<span class="bu">sum</span>())</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    local_count <span class="op">=</span> <span class="bu">len</span>(col_data)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"sum"</span>: local_sum, <span class="st">"count"</span>: local_count}</span></code></pre>
</div>
<p>In test.py:</p>
<ul><li>In the <code>client.task.create()</code> calls, replace the
<code>column</code> argument with the column you want to calculate the
average over: <code>"Age"</code>.</li>
</ul><p>Then, you can run <code>python test/test.py</code> and the output
should look something like:</p>
<pre><code>
[{'id': 0, 'name': 'mock-0', 'domain': 'mock-0.org', 'address1': 'mock', 'address2': 'mock', 'zipcode': 'mock', 'country': 'mock', 'public_key': 'mock', 'collaborations': '/api/collaboration?organization_id=0', 'users': '/api/user?organization_id=0', 'tasks': '/api/task?init_org_id=0', 'nodes': '/api/node?organization_id=0', 'runs': '/api/run?organization_id=0'}, {'id': 1, 'name': 'mock-1', 'domain': 'mock-1.org', 'address1': 'mock', 'address2': 'mock', 'zipcode': 'mock', 'country': 'mock', 'public_key': 'mock', 'collaborations': '/api/collaboration?organization_id=1', 'users': '/api/user?organization_id=1', 'tasks': '/api/task?init_org_id=1', 'nodes': '/api/node?organization_id=1', 'runs': '/api/run?organization_id=1'}]
info &gt; Defining input parameters
info &gt; Creating subtask for all organizations in the collaboration
info &gt; Waiting for results
info &gt; Mocking waiting for results
info &gt; Results obtained!
info &gt; Mocking waiting for results
[{'average': 34.666666666666664}]
{'id': 2, 'runs': '/api/run?task_id=2', 'results': '/api/results?task_id=2', 'status': 'completed', 'name': 'mock', 'databases': ['mock'], 'description': 'mock', 'image': 'mock_image', 'init_user': {'id': 1, 'link': '/api/user/1', 'methods': ['GET', 'DELETE', 'PATCH']}, 'init_org': {'id': 0, 'link': '/api/organization/0', 'methods': ['GET', 'PATCH']}, 'parent': None, 'collaboration': {'id': 1, 'link': '/api/collaboration/1', 'methods': ['DELETE', 'PATCH', 'GET']}, 'job_id': 1, 'children': None}
info &gt; Mocking waiting for results
[{'sum': 624.0, 'count': 18}, {'sum': 624.0, 'count': 18}]
</code></pre>
<p>Hence, the average age is 34.67!</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="build-your-algorithm-into-a-docker-image">Build your algorithm into a docker image<a class="anchor" aria-label="anchor" href="#build-your-algorithm-into-a-docker-image"></a></h2>
<hr class="half-width"><p>To be able to run your algorithm in the vantage6 infrastructure, you
need to make your algorithm available online. To do so, you need access
to a Docker registry. The easiest way to do this is to use Dockerhub. To
create an account there, go <a href="https://app.docker.com/signup?" class="external-link">here</a>.</p>
<p>Your algorithm boilerplate contains a <code>Dockerfile</code> in the
root folder. Enter the following commands to build your algorithm into a
docker image. Be sure to replace <code>$myusername</code> with your
Dockerhub username.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="bu">cd</span> /go/to/directory/with/my/algorithm/and/the/dockerfile</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">docker</span> login</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="va">$myusername</span>/average .</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="ex">docker</span> push <span class="va">$myusername</span>/average</span></code></pre>
</div>
<p>This uses the command <code>docker build</code> to build your
algorithm into a Docker image, and then the image is uploaded with
<code>docker push</code>.</p>
</section><section><h2 class="section-heading" id="set-up-a-local-test-environment">Set up a local test environment<a class="anchor" aria-label="anchor" href="#set-up-a-local-test-environment"></a></h2>
<hr class="half-width"><p>When the algorithm image is available, it is recommended to test
locally if it also works with an actual server and nodes - not just
using the mock client. In this section, we will test your algorithm via
vantage6 on your own machine. The easiest way to set up a server and a
few nodes locally is with:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">v6</span> dev create-demo-network</span></code></pre>
</div>
<p>This command creates a vantage6 server configuration, and then
registers a collaboration with 3 organizations in it. It registers a
node for each organization and finally, it creates the vantage6 node
configuration for each node with the correct API key.</p>
<p>Each node in the <code>v6 dev</code> network has part of a dataset on
olympic medal winners in the 2016 Olympics. The dataset contains the
columns <code>Age</code>, <code>Sex</code>, <code>Height</code>,
<code>Weight</code>, <code>Country</code>, <code>Sport</code> and
<code>Medal</code>. We are mainly interested in the <code>Age</code>
column for our average computation, but of course you can also compute
the average over other columns, as long as they are numeric.</p>
<p>The other available commands are:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Start the server and nodes</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">v6</span> dev start-demo-network</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># Stop the server and nodes</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="ex">v6</span> dev stop-demo-network</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Remove the server and nodes</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="ex">v6</span> dev remove-demo-network</span></code></pre>
</div>
<p>In <a href="./chap5_python_client.html">Chapter 5</a>, you have
learned how to run an algorithm using the Python client. Now, you can
run your own algorithm using the Python client!</p>
<div id="challenge-4-test-your-algorithm-on-a-local-vantage6-network" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-4-test-your-algorithm-on-a-local-vantage6-network" class="callout-inner">
<h3 class="callout-title">Challenge 4: Test your algorithm on a local vantage6 network</h3>
<div class="callout-content">
<p>Create and start a local vantage6 network with the
<code>v6 dev</code> commands. Then, run your algorithm using the Python
client. Note that the data in the <code>v6 dev</code> network is
different from the mock data you used before - however it contains the
same column â€œAgeâ€.</p>
<p>If you are on Linux and are <em>not</em> using Docker Desktop, you
will need to run
<code>v6 dev create-demo-network --server-url http://172.17.0.1</code> -
this to let vantage6 know where they can reach localhost from within the
Docker container.</p>
<p>You can use the following data to login:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># login credentials</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>username <span class="op">=</span> <span class="st">"dev_admin"</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>password <span class="op">=</span> <span class="st">"password"</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># server details</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>server_url <span class="op">=</span> <span class="st">"http://localhost"</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>port <span class="op">=</span> <span class="dv">7601</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>api_path <span class="op">=</span> <span class="st">"/api"</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># task details</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>databases <span class="op">=</span> [{<span class="st">"label"</span>: <span class="st">"default"</span>}]</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>column_name <span class="op">=</span> <span class="st">"Age"</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>Use <code>help(client.task.create)</code> to see the available
arguments for the <code>create</code> method. Your command should be
similar to the command in the test script, but with the correct
collaboration/organization ID</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>After doing <code>v6 dev create-demo-network</code> and
<code>v6 dev start-demo-network</code>, you can run the following Python
script to run your algorithm on the local network. Take care to provide
the correct username, password, and image name.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="im">from</span> vantage6.client <span class="im">import</span> Client</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>client.authenticate(username, password)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>image <span class="op">=</span> <span class="st">"myusername/average"</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>task <span class="op">=</span> client.task.create(</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    input_<span class="op">=</span>{</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        <span class="st">"method"</span>: <span class="st">"central_function"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        <span class="st">"kwargs"</span>: {</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>            <span class="st">"column"</span>: <span class="st">"Age"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>        },</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    },</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>    organizations<span class="op">=</span>[<span class="dv">1</span>],</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>    databases <span class="op">=</span> [{<span class="st">"label"</span>: <span class="st">"default"</span>}],</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"test task"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>    description<span class="op">=</span><span class="st">"My description"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>    collaboration<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>    image<span class="op">=</span>image</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>)</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>results <span class="op">=</span> client.wait_for_results(central_task.get(<span class="st">"id"</span>))</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="bu">print</span>(results)</span></code></pre>
</div>
<p>which should print:</p>
<pre><code>{'data': [{'result': '{"average": 27.613448844884488}',
   'task': {'id': 2, 'link': '/api/task/2', 'methods': ['DELETE', 'GET']},
   'run': {'id': 4, 'link': '/api/run/4', 'methods': ['GET', 'PATCH']},
   'id': 4}],
 'links': {'first': '/api/result?task_id=2&amp;page=1',
  'self': '/api/result?task_id=2&amp;page=1',
  'last': '/api/result?task_id=2&amp;page=1'}}</code></pre>
<p>So the average age is 27.61!</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="publish-your-algorithm-in-the-algorithm-store">Publish your algorithm in the algorithm store<a class="anchor" aria-label="anchor" href="#publish-your-algorithm-in-the-algorithm-store"></a></h2>
<hr class="half-width"><p><a href="./chap3_run_analysis_ui.html">Previously</a>, we have
discussed how to run algorithms from the algorithm store. Now, it is
time to publish your own algorithm in the algorithm store. This is
required if you want to run your algorithm in the user interface: the
user interface gathers information about how to run the algorithm from
the algorithm store. For example, this helps the UI to construct a
dropdown of available functions, and to know what arguments the function
expects.</p>
<p>The boilerplate you create should already contain an
<code>algorithm_store.json</code> file that contains a JSON description
of your algorithm - how many databases each function uses, for
example.</p>
<p>You can put the algorithm in the store by selecting the local
algorithm store in the UI. You should upload this algorithm into your
local test store, which is part of the <code>v6 dev</code> network. You
can do this by selecting that store in the UI, and then by clicking on
the â€œAdd algorithmâ€ button on the page with approved algorithms. You can
upload the <code>algorithm_store.json</code> file in the top. After
uploading it, you can change the details of the algorithm before
submitting it.</p>
<div id="challenge-5-add-your-algorithm-to-the-algorithm-store" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-5-add-your-algorithm-to-the-algorithm-store" class="callout-inner">
<h3 class="callout-title">Challenge 5: Add your algorithm to the algorithm store</h3>
<div class="callout-content">
<p>Your local <code>v6 dev</code> network is running an algorithm store
locally on <code>http://localhost:7602</code>, and a user interface on
<code>http://localhost:7600</code>. Log in to the UI and upload your
algorithm to the algorithm store. Note: the UI requests a link to your
code - you can fill in a dummy link for now.</p>
<p>Then, can you download the revised JSON file so you can update it in
your algorithm repository?</p>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Give me a hint </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>Use the <code>algorithm_store.json</code> which is present in your
algorithm code repository to fill in most of the details. Note, however,
that not everything is prefilled and you also need to adjust some
existing fields. Which fields do you need to adjust?</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Go to the UI and log in. Then, go to the â€˜Algorithm storeâ€™ section
and select the local algorithm store. Go to â€˜Approved algorithmsâ€™, click
on â€˜Add algorithmâ€™ and upload the <code>algorithm_store.json</code>
file. Fill in the correct image name and set the type of the argument
â€˜columnâ€™ to â€˜Columnâ€™ (this will ensure that the UI displays a dropdown
of all available columns).</p>
<p>You can find the revised JSON file on the page with the algorithm
details.</p>
</div>
</div>
</div>
</div>
<div id="challenge-6-run-your-algorithm-in-the-ui" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-6-run-your-algorithm-in-the-ui" class="callout-inner">
<h3 class="callout-title">Challenge 6: Run your algorithm in the UI</h3>
<div class="callout-content">
<p>Run your algorithm in the UI. The <code>v6 dev</code> network should
already provide you with a collaboration where all nodes are online.</p>
<p>Verify that the average age is still the same. Can you also get the
average height and weight?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>Make sure that your <code>v6 dev</code> network is running. If not,
start it again with <code>v6 dev start-demo-network</code>.</li>
<li>Login to the UI, go to â€˜Analyzeâ€™ section, select â€˜Taskâ€™ and â€˜Create
taskâ€™.</li>
<li>Select your algorithm from the dropdown.</li>
<li>Fill in the required fields. You should select the central function
and provide the column you want to calculate the average over.</li>
<li>Your algorithm should run successfully in the UI. The result should
- obviously - be the same as when you ran it with the Python client, so
we are expecting:</li>
</ol><p><code>Average ~= 27.61</code>.</p>
<p>Similarly, you can get the average height at 178.5 and the average
weight at 74.3.</p>
</div>
</div>
</div>
</div>
<div id="challenge-7-advanced-calculate-the-average-per-group" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-7-advanced-calculate-the-average-per-group" class="callout-inner">
<h3 class="callout-title">Challenge 7 (Advanced): Calculate the average per group</h3>
<div class="callout-content">
<p>Extend your algorithm to answer the following question: in the
<code>v6 dev</code> dataset, are gold medal winners older or younger
than silver medal winners?</p>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Give me a hint </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" aria-labelledby="headingHint4" data-bs-parent="#accordionHint4">
<div class="accordion-body">
<p>Add a <code>group_by</code> argument to both the central and the
partial function. Pass this argument to the partial function when
creating the subtask, and use it in the partial function to group the
data.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p>A working solution is provided in the <a href="https://github.com/vantage6/workshop-average-boilerplate/tree/advanced-challenge" class="external-link">workshop-average-boilerplate
repository</a>. Of course, multiple solutions are possible. Below is a
description of what you need to change compared to the algorithm
implementation you created in Challenge 2.</p>
<p>Your partial function may now look like this:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="at">@data</span>(<span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="kw">def</span> partial_function(df: pd.DataFrame, column, group_by) <span class="op">-&gt;</span> Any:</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="co">"""Decentral part of the algorithm"""</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>    grouped <span class="op">=</span> df.groupby(group_by)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>        <span class="st">"sum"</span>: grouped[column].<span class="bu">sum</span>().to_dict(),</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>        <span class="st">"count"</span>: grouped[column].size().to_dict(),</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    }</span></code></pre>
</div>
<p>Your central function should be adapted to pass the
<code>group_by</code> argument to the partial function, and it should
aggregate the results per group, as something like this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="kw">def</span> central_function(client: AlgorithmClient, column: <span class="bu">str</span>, group_by: <span class="bu">str</span>):</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    ...</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    results <span class="op">=</span> client.wait_for_results(task_id<span class="op">=</span>task.get(<span class="st">"id"</span>))</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>    global_sums <span class="op">=</span> {}</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>    global_counts <span class="op">=</span> {}</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>    <span class="cf">for</span> output <span class="kw">in</span> results:</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>        <span class="cf">for</span> key, value <span class="kw">in</span> output[<span class="st">"sum"</span>].items():</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> global_sums:</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>                global_sums[key] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>            global_sums[key] <span class="op">+=</span> value</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>        <span class="cf">for</span> key, value <span class="kw">in</span> output[<span class="st">"count"</span>].items():</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> global_counts:</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>                global_counts[key] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>            global_counts[key] <span class="op">+=</span> value</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>    results <span class="op">=</span> {}</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>    <span class="cf">for</span> key, value <span class="kw">in</span> global_sums.items():</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>        results[key] <span class="op">=</span> value <span class="op">/</span> global_counts[key]</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>    <span class="cf">return</span> results</span></code></pre>
</div>
<p>And when running this, the final results are:</p>
<pre><code>{"Bronze":27.39364035087719,"Gold":27.86445366528354,"Silver":27.637515842839036}</code></pre>
<p>Gold medal winners are older than silver medal winners. Practice
makes perfect!</p>
<p>In case you also aspire to be perfect, feel free to practice some
more. Be creative and think of other questions you can answer with this
dataset!</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a></h2>
<hr class="half-width"><p>Congratulations! You have successfully developed your first vantage6
algorithm. You have learned how to create a personalized boilerplate,
implement the algorithm functions, and run the algorithm using the
Python client and the UI. The resulting algorithm, however, is not
suitable yet for real-world use. For instance, if a node contains only a
single data point for a given column, there are no guards implemented
that prevent that such sensitive data is shared with the server. The
following steps are usually important to address before your algorithm
is ready for real-world use:</p>
<ul><li>
<strong>Privacy guards</strong>: implement privacy guards to ensure
that sensitive data is not shared with the server.</li>
<li>
<strong>Error handling</strong>: implement error handling to ensure
that the algorithm does not crash when unexpected input is provided.
Note that there are <a href="https://docs.vantage6.ai/en/main/function-docs/_autosummary/vantage6.algorithm.tools.exceptions.html#module-vantage6.algorithm.tools.exceptions" class="external-link">custom
vantage6 errors</a> that you can raise to provide more information about
what went wrong.</li>
<li>
<strong>Documentation</strong>: document your algorithm so that
others can understand how to use it, what their data should look like,
how to interpret the results, etc.</li>
</ul><p>Other next steps could be to extend the algorithm with more
functionality, such as allowing to calculate the average over multiple
columns, or to add a <code>group_by</code> argument to compute the
average per group.</p>
<p>In the final lesson of this course, you will have the opportunity to
work on your own projects. You can also use that to further develop your
algorithm!</p>
</section><section><h2 class="section-heading" id="future-changes">Future changes<a class="anchor" aria-label="anchor" href="#future-changes"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="sessions">Sessions<a class="anchor" aria-label="anchor" href="#sessions"></a></h3>
<p>We are currently using vantage6 version 4.7.1. The vantage6 team is
working on vantage6 version 5.0, which will bring changes to the
algorithm development process. Version 5.0 will introduce sessions,
which are a way to split up the algorithm into smaller parts: data
preparation, data preprocessing, data analysis, and post-processing. A
major advantage of this is that extensive data preparation only needs to
be done once per node instead of once per task, which can save a lot of
time. Also, it will be possible for a more experienced user to prepare
the data, while a less experienced user can simply run the algorithm on
the prepared data.</p>
<p>For algorithm developers, the sessions mean that you should then
split your algorithm functions into data preparation, analysis,
postprocessing, etc. The vantage6 team will make sure that proper
documentation will be available to help you with this transition.</p>
</div>
<div class="section level3">
<h3 id="algorithm-build-service">Algorithm build service<a class="anchor" aria-label="anchor" href="#algorithm-build-service"></a></h3>
<p>As was already mentioned <a href="./chap2_introduction_v6.html#build-services">previously</a>, the
vantage6 team is working on a build service that will automatically
build your algorithm into a Docker image. This will alleviate the
algorithm developer from having to worry about the Docker image, and
will allow them to focus on the algorithm itself. Also, it will ensure
that the image is built in a consistent and secure way, which may
enhance the trust in an algorithm image.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Use <code>v6 algorithm create</code> to create a personalized
boilerplate</li>
<li>Implement the partial functions to run on each node and the central
function to aggregate the results</li>
<li>Build your algorithm into a docker image</li>
<li>Test it with the mock client and with a local <code>v6 dev</code>
test environment</li>
<li>Publish your algorithm in the algorithm store to run it in the
UI</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="chap6_setup_node.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="chap8_own_project.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="chap6_setup_node.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Setting up a
        </a>
        <a class="chapter-link float-end" href="chap8_own_project.html" rel="next">
          Next: Work on your own...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/vantage6/vantage6-workshop/edit/main/episodes/chap7_algo_dev.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/vantage6/vantage6-workshop/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/vantage6/vantage6-workshop/" class="external-link">Source</a></p>
				<p><a href="https://github.com/vantage6/vantage6-workshop/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:d.smits@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://vantage6.github.io/vantage6-workshop/chap7_algo_dev.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "federated learning, privacy enhancing technology, python",
  "name": "Algorithm development",
  "creativeWorkStatus": "active",
  "url": "https://vantage6.github.io/vantage6-workshop/chap7_algo_dev.html",
  "identifier": "https://vantage6.github.io/vantage6-workshop/chap7_algo_dev.html",
  "dateCreated": "2024-03-26",
  "dateModified": "2024-10-02",
  "datePublished": "2024-10-02"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

